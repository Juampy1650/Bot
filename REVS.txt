Funcion para boton de volver al menu


const flowMenuInicial = addKeyword(['volver', 'regresar'])
    .addAnswer(
        [
            '游댗 Volviendo al men칰 inicial',
            'Escribe el n칰mero para seleccionar la opci칩n:',
            '游녤 *1* Realizar un pedido',
            '游녤 *2* Pagina Web',
            '游녤 *3* Contactar con un operador',
        ],
        null,
        { capture: true },
        async (ctx, { fallBack }) => {
            if (!['1', '2', '3'].includes(ctx.body)) {
                return fallBack("Por favor selecciona una opci칩n v치lida *1, 2, 3*");
            }
        },
        null,
        [flowOperador, flowPagina, flowPedido]
    );

const flowBienvenida = addKeyword(["hola", 'pedido'])
    .addAnswer('Bienvenido')
    .addAnswer('游뗿 Hola, Gracias por comunicarte a Sphera Digital, 쯘n qu칠 te podemos ayudar hoy?')
    .addAnswer(
        [
            'Escribe el n칰mero para seleccionar la opci칩n',
            '游녤 *1* Realizar un pedido',
            '游녤 *2* P치gina Web',
            '游녤 *3* Contactar con un operador',
        ],
        null,
        { capture: true },
        async (ctx, { fallBack }) => {
            if (!['1', '2', '3'].includes(ctx.body)) {
                return fallBack("Por favor selecciona una opci칩n v치lida *1, 2, 3*");
            }
        },
        null,
        [flowOperador, flowPagina, flowPedido, flowMenuInicial]
    );



Funcion con carrito y catalogo

const { createBot, createProvider, createFlow, addKeyword } = require('@bot-whatsapp/bot');
const stripe = require('stripe')('TU_CLAVE_SECRETA_DE_STRIPE');

// Flujo de bienvenida
const flowBienvenida = addKeyword(['hola', 'inicio'])
  .addAnswer('춰Bienvenido a nuestra tienda!')
  .addAnswer('쮼n qu칠 te podemos ayudar hoy?')
  .addAnswer(
    [
      'Selecciona una opci칩n:',
      '游 Ver cat치logo',
      '游 Ver carrito',
    ],
    null,
    { capture: true }
  );

// Flujo del cat치logo
const flowCatalogo = addKeyword(['cat치logo', 'productos'])
  .addAnswer('Estos son nuestros productos:')
  .addAnswer(
    [
      '1. Producto A',
      '2. Producto B',
      '3. Producto C',
      // ... Agrega aqu칤 m치s productos
      '9. Regresar al men칰 principal',
    ],
    null,
    { capture: true }
  )
  .addAnswer(
    'Ingresa el n칰mero del producto que deseas a침adir al carrito.',
    null,
    { capture: true },
    async (ctx, { addToCart }) => {
      const productNumber = parseInt(ctx.body);
      if (productNumber >= 1 && productNumber <= 3) {
        const product = obtenerProductoDelCatalogo(productNumber); // Funci칩n para obtener los detalles del producto
        addToCart(product);
        ctx.sendText('Producto a침adido al carrito.');
      } else if (productNumber === 9) {
        ctx.goto(flowBienvenida);
      } else {
        ctx.sendText('Por favor, selecciona un n칰mero v치lido.');
      }
    }
  );

// Flujo de ver carrito
const flowCarrito = addKeyword(['carrito'])
  .addAnswer(
    'Este es tu carrito:',
    null,
    null,
    async (ctx, { getCartItems }) => {
      const cartItems = getCartItems(); // Funci칩n para obtener los productos a침adidos al carrito
      if (cartItems.length > 0) {
        const cartText = cartItems.map((item, index) => `${index + 1}. ${item.name} - ${item.price}`).join('\n');
        ctx.sendText(`Productos en tu carrito:\n${cartText}`);
        ctx.goto(flowConfirmarPago);
      } else {
        ctx.sendText('Tu carrito est치 vac칤o.');
        ctx.goto(flowBienvenida);
      }
    }
  );

// Flujo de confirmar pago
const flowConfirmarPago = addKeyword(['pagar', 'realizar pago'])
  .addAnswer(
    'Para realizar el pago, haz clic en el siguiente enlace:',
    null,
    null,
    async (ctx, { getCartItems }) => {
      const cartItems = getCartItems(); // Funci칩n para obtener los productos a침adidos al carrito

      const session = await stripe.checkout.sessions.create({
        payment_method_types: ['card'],
        line_items: cartItems.map(item => ({
          price_data: {
            currency: 'usd',
            product_data: {
              name: item.name,
            },
            unit_amount: item.price * 100, // El precio debe estar en centavos
          },
          quantity: 1,
        })),
        mode: 'payment',
        success_url: 'https://ejemplo.com/pago-exitoso',
        cancel_url: 'https://ejemplo.com/pago-cancelado',
      });

      ctx.sendText(`Haz clic aqu칤 para realizar el pago: ${session.url}`);
    }
  );

// Funci칩n para obtener los detalles del producto desde el cat치logo
function obtenerProductoDelCatalogo(productNumber) {
  // Aqu칤 puedes implementar la l칩gica para obtener los detalles del producto
  // seg칰n el n칰mero de producto seleccionado
  // Retornar un objeto con los detalles del producto, como { name: 'Producto A', price: 10 }
}

// Funciones de gesti칩n del carrito
function addToCart(product) {
  // Aqu칤 puedes implementar la l칩gica para agregar el producto al carrito
}

function getCartItems() {
  // Aqu칤 puedes implementar la l칩gica para obtener los productos a침adidos al carrito
  // Retornar un array de objetos con los detalles de los productos
}

// Configuraci칩n del bot
const adapterFlow = createFlow([flowBienvenida, flowCatalogo, flowCarrito, flowConfirmarPago]);
const adapterProvider = createProvider(BaileysProvider);

createBot({
  flow: adapterFlow,
  provider: adapterProvider,
  // ...
});
